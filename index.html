<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlayCanvas Editor - Local Development</title>
    <meta name="description" content="Local Development Server for PlayCanvas Editor">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/editor.css">
    <link rel="stylesheet" href="css/code-editor.css">
    <link rel="stylesheet" href="css/error.css">
    <link rel="stylesheet" href="css/launch.css">
</head>
<body>
    <div id="root"></div>
    <div id="notify-root"></div>
    
    <!-- Scripts -->
    <script>
        // Initialize global config object before editor loads
        // This is normally provided by the PlayCanvas backend
        window.config = {
            // User and auth info
            self: {
                id: 0,
                username: 'local_user',
                email: 'user@localhost',
                role: 'admin',
                flags: {
                    openedEditor: true,
                    superUser: true,
                    hasZoneComponent: true,
                    hasBundles: true,
                    hasRecompressFlippedTextures: true,
                    hasFixCorruptedTemplates: true,
                    hasTextureToSprite: true,
                    hasExtendedMatProps: true,
                    hasAnisoGGXSpec: true,
                    has2DBatchGroups: true,
                    hasUnwrapUv: true
                },
                branch: {
                    id: 0,
                    name: 'main',
                    merge: null
                }
            },
            // Project info
            project: {
                id: 12345,
                name: 'Local Project',
                settings: {
                    engineV2: false,
                    engineVersion: 'current'
                }
            },
            // Engine versions available in the editor UI
            engineVersions: {
                previous: { version: '1.65.0', description: 'Previous Stable' },
                current: { version: '1.66.0', description: 'Current Stable' },
                releaseCandidate: { version: '1.67.0', description: 'Release Candidate' },
                force: { version: '1.66.0', description: 'Forced Current' }
            },
            // Scene info
            scene: {
                id: 54321,
                name: 'Scene'
            },
            // API schema - defines structure of data
            schema: {
                // Minimal schema to satisfy editor expectations in offline mode
                scene: {
                    // The editor expects config.schema.scene.entities.$of.components
                    entities: {
                        $of: {
                            // Minimal components map; can be extended
                            components: {
                                model: {},
                                render: {},
                                camera: {},
                                light: {},
                                script: {
                                    scripts: {
                                        $editorType: 'json',
                                        $default: []
                                    }
                                }
                            }
                        }
                    },
                    settings: {}
                },
                asset: {
                    // Provide a minimal asset type enum for UI that inspects clipboard and schemas
                    type: {
                        $enum: [
                            'animation',
                            'audio',
                            'binary',
                            'bundle',
                            'container',
                            'cubemap',
                            'css',
                            'font',
                            'html',
                            'json',
                            'material',
                            'model',
                            'render',
                            'script',
                            'shader',
                            'sprite',
                            'template',
                            'text',
                            'texture',
                            'texture-atlas',
                            'wasm'
                        ]
                    }
                },
                component: {}
            },
            // API URLs
            url: {
                // Point API to local dev server to avoid remote fetches in offline mode
                api: window.location.origin + '/api',
                home: 'https://playcanvas.com',
                frontend: window.location.origin + '/',
                engine: window.location.origin + '/js/vendor/playcanvas.js'
            },
            // Access token for API calls
            accessToken: 'development-token',
            // Realtime/WebSocket URL
            realtimeUrl: 'wss://realtime.playcanvas.com'
        };
            // Some legacy scripts expect a global `log` object with log/error
            window.log = console;

        // Configuration for local development
        // Get environment variables from server (injected during page load)
        const serverConfig = window.__SERVER_CONFIG__ || {};
        window.EDITOR_CONFIG = {
            apiUrl: serverConfig.apiUrl || 'https://api.playcanvas.com',
            realtimeUrl: serverConfig.realtimeUrl || 'wss://realtime.playcanvas.com',
            uploadUrl: serverConfig.uploadUrl || 'https://upload.playcanvas.com',
            environment: 'development',
            useLocalFrontend: true
        };
    </script>

    <!-- Load PlayCanvas engine global before the editor -->
    <script src="js/vendor/playcanvas.js"></script>
    <!-- Load UMD scripts -->
    <script src="js/editor.js"></script>

    <!-- HMR for development (Vite) -->
    <script type="module">
        if (import.meta.hot) {
            import.meta.hot.accept(() => {
                window.location.reload();
            });
        }
    </script>
</body>
</html>
